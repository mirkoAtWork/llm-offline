<div class="translator-container">


    <!-- Info Accordion -->
    <mat-accordion class="info-accordion">
        <mat-expansion-panel>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Chrome Built-in AI APIs
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="info-content">
                <!-- orientation="horizontal" -->
                <mat-stepper orientation="vertical"
                             [linear]="false">
                    <!-- Step 1: Overview -->
                    <mat-step label="Overview">
                        <h3>Stable APIs (Available Now)</h3>
                        <h4>Translator API</h4>
                        <p>
                            L'API sperimentale <strong>Translator API</strong> consente di eseguire traduzioni in tempo
                            reale
                            direttamente nel browser, senza chiamate lato server.
                        </p>
                        <h4>Language Detection API</h4>
                        <p>
                            La <strong>Language Detection API</strong> permette di identificare automaticamente la
                            lingua di un
                            testo fornito.
                        </p>
                        <h3>Other Experimental APIs</h3>
                        <ul>
                            <li><strong>Prompt API</strong>: Modelli Gemini Nano.</li>
                            <li><strong>Summarization API</strong>: Generazione riassunti.</li>
                            <li><strong>Write API</strong>: Assistenza alla scrittura.</li>
                            <li><strong>Rewriter API</strong>: Riformulazione testi.</li>
                        </ul>
                    </mat-step>

                    <!-- Step 2: Language Detector Tutorial -->
                    <mat-step label="Language Detector API Tutorial">
                        <p>Tutorial: Come rilevare la lingua.</p>
                        <ol>
                            <li>Verifica disponibilità:
                                <code>const available = (await window.ai.languageDetector.capabilities()).available;</code>
                            </li>
                            <li>Crea il detector:
                                <code>const detector = await window.ai.languageDetector.create();</code>
                            </li>
                            <li>Rileva:
                                <code>const results = await detector.detect('Ciao mondo');</code>
                            </li>
                        </ol>
                    </mat-step>

                    <!-- Step 3: Translator API Tutorial -->
                    <mat-step label="Translator API Tutorial">
                        <p>Tutorial: Come tradurre testo.</p>
                        <ol>
                            <li>Verifica disponibilità:
                                <code>const canTranslate = await window.translation.canTranslate({{ '{' }} sourceLanguage: 'en', targetLanguage: 'es' {{ '}' }});</code>
                            </li>
                            <li>Crea il traduttore:
                                <code>const translator = await window.translation.createTranslator({{ '{' }} sourceLanguage: 'en', targetLanguage: 'es' {{ '}' }});</code>
                            </li>
                            <li>Traduci:
                                <code>const translated = await translator.translate('Hello world');</code>
                            </li>
                        </ol>
                    </mat-step>

                    <!-- Step 4: References -->
                    <mat-step label="References">
                        <h3>Useful Links</h3>
                        <ul>
                            <li>
                                <a href="https://developer.chrome.com/docs/ai/translator-api"
                                   target="_blank">Translator API Documentation</a>
                            </li>
                        </ul>
                    </mat-step>
                </mat-stepper>
            </div>
        </mat-expansion-panel>
    </mat-accordion>


    <div class="progress-bar-container">
        <h5>Download Translate progress: </h5>
        <mat-progress-bar mode="determinate"
                          [value]="loadingDetector() * 100"></mat-progress-bar>
    </div>
    <div class="autodectect-container">
        <div class="translator-controls">
            <mat-slide-toggle [checked]="autoDetectLanguage()"
                              (change)="autoDetectLanguage.set($event.checked)">
                Auto-detect Language
            </mat-slide-toggle>
        </div>
        <div class="detected-language">
            DetectedLanguage:
            @if(detectedLang().detectedLanguage != '' && detectedLang().detectedLanguage != "und") {
            {{ detectedLang().detectedLanguage }} - Confidence: {{ detectedLang().confidence }}
            }
        </div>
    </div>
    <div class="translation-panels">
        <!-- Source Panel -->
        <div class="panel source-panel">
            <mat-tab-group [(selectedIndex)]="sourceLangIndex"
                           (selectedTabChange)="onSourceTabChange($event)"
                           animationDuration="0ms">
                @for (lang of languages; track lang.code) {
                <mat-tab [label]="lang.name"></mat-tab>
                }
            </mat-tab-group>

            <mat-form-field appearance="fill"
                            class="text-area-field">
                <textarea matInput
                          placeholder="Enter text"
                          [ngModel]="sourceText()"
                          (ngModelChange)="updateSourceText($event)"
                          rows="10"></textarea>
                @if (sourceText()) {
                <button mat-icon-button
                        matSuffix
                        (click)="updateSourceText('')">
                    <mat-icon>close</mat-icon>
                </button>
                }
            </mat-form-field>
        </div>

        <!-- Swap Button (Centered Overlay or Flex item) -->
        <div class="swap-container">
            <button mat-icon-button
                    (click)="swapLanguages()">
                <mat-icon>swap_horiz</mat-icon>
            </button>
        </div>

        <!-- Target Panel -->
        <div class="panel target-panel">
            <mat-tab-group [(selectedIndex)]="targetLangIndex"
                           (selectedTabChange)="onTargetTabChange($event)"
                           animationDuration="0ms">
                @for (lang of languages; track lang.code) {
                <mat-tab [label]="lang.name"></mat-tab>
                }
            </mat-tab-group>

            <mat-form-field appearance="fill"
                            class="text-area-field">
                <textarea matInput
                          readonly
                          [value]="translatedText()"
                          rows="10"></textarea>
                <button mat-icon-button
                        matSuffix
                        (click)="copyToClipboard()">
                    <mat-icon>content_copy</mat-icon>
                </button>
            </mat-form-field>
        </div>
    </div>
</div>