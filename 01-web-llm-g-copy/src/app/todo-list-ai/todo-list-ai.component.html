<main class="todo-list-ai-container">
  <mat-accordion class="info-accordion">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Cos'è WebLLM?
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="info-content">
        <mat-stepper orientation="vertical"
                     [linear]="false">
          <!-- Step 1: Overview -->
          <mat-step label="Cos'è WebLLM">
            <h3>Cos'è WebLLM</h3>
            <p>
              <strong>WebLLM</strong> è una libreria ad alte prestazioni che porta i Large Language Models (LLM) e i
              Large
              Multimodal Models (LMM) direttamente nei browser web.
            </p>
            <h3>Come funziona</h3>
            <p>
              Utilizza <strong>WebGPU</strong> per l'accelerazione hardware direttamente nel browser, permettendo
              l'esecuzione di modelli pesanti senza la necessità di inviare dati a un server (Privacy First). Tutto
              avviene localmente sul tuo dispositivo.
            </p>
          </mat-step>

          <!-- Step 2: Comandi Principali -->
          <mat-step label="Comandi Principali">
            <h3>Inizializzazione</h3>
            <p>Inizializza il motore AI con il modello specificato:</p>
            <pre><code>CreateMLCEngine(modelId, config)</code></pre>

            <h3>Chat Completion</h3>
            <p>Genera una risposta basata sulla cronologia della chat:</p>
            <pre><code>{{
`engine.chat.completions.create(...)`
            }}</code></pre>

            <h3>Reset Chat</h3>
            <p>Pulisce la cronologia della conversazione corrente:</p>
            <pre><code>engine.resetChat()</code></pre>
          </mat-step>
        </mat-stepper>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <div class="model-controls">
    <mat-slide-toggle [checked]="showAllModels()"
                      (change)="toggleModelSource()">
      Show all models
    </mat-slide-toggle>

    <mat-form-field class="model-selector">
      <mat-label>Select Model</mat-label>
      <mat-select [value]="selectedModel()"
                  (selectionChange)="onModelChange($event.value)"
                  [disabled]="!ready()">
        @for (model of models; track model.id) {
        <mat-option [value]="model.id">{{model.name}}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>


  <!-- @if (!ready()) { -->
  <div class="progress-bar-container">
    <h5>Download Llm progress: </h5>
    <mat-progress-bar mode="determinate"
                      [value]="progress() * 100"></mat-progress-bar>
  </div>
  <!-- } -->

  <mat-list>
    @for (todo of todos(); track todo) {
    <mat-list-item>
      <div class="content">
        <mat-checkbox [checked]="todo.done"
                      (change)="toggleTodo(todo)"></mat-checkbox>

        <span>{{ todo.text }}</span>

        <button mat-icon-button
                (click)="deleteTodo(todo)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </mat-list-item>
    }
  </mat-list>
  @if(reply()) {
  <mat-card class="reply-card">
    <mat-card-content>
      <pre>{{ reply() }}</pre>
    </mat-card-content>
  </mat-card>
  }
  <section class="prompt-container">
    <mat-form-field>
      <mat-label>{{ready()? 'Prompt': 'download model in progress...'}}</mat-label>
      <input matInput
             placeholder="Prompt"
             #prompt
             (keyup.enter)="runPrompt(prompt.value)"
             (input)="(null)"
             [disabled]="!ready()">
      @if (prompt.value) {
      <button mat-icon-button
              matSuffix
              (click)="prompt.value = ''"
              [attr.aria-label]="'Clear prompt'">
        <mat-icon>close</mat-icon>
      </button>
      }
    </mat-form-field>

    <button mat-raised-button
            (click)="runPrompt(prompt.value)"
            [disabled]="!ready()">
      <mat-icon>send</mat-icon>
      Ask
    </button>
  </section>

  <button mat-fab
          (click)="addTodo()">
    <mat-icon>add</mat-icon>
  </button>



</main>